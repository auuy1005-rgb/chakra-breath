<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è„ˆè¼ªå‘¼å¸å†¥æƒ³ï½œChakra Breath</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #020617;
      --card: #020617;
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --border-soft: #1f2937;
      --accent: #38bdf8;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 16px;
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%, #020617 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 520px;
      background: linear-gradient(145deg, rgba(15,23,42,0.9), rgba(2,6,23,0.98));
      border-radius: 22px;
      padding: 18px 16px 18px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
      border: 1px solid #1f2937;
    }

    .title {
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }
    .title span.emoji {
      font-size: 22px;
    }
    .subtitle {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 14px;
      line-height: 1.4;
    }

    .top-layout {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* äººå½¢ ï¼‹ è„ˆè¼ªåœ– */
    .figure-card {
      border-radius: 18px;
      border: 1px solid #1f2937;
      background: radial-gradient(circle at top, #0b1120, #020617);
      padding: 12px 10px 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .figure-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      margin-top: 4px;
      margin-bottom: 6px;
    }

    .human-figure {
      position: relative;
      width: 180px;
      height: 230px;
      filter: drop-shadow(0 10px 14px rgba(15,23,42,0.9));
    }

    .hf-core {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hf-body {
      position: absolute;
      left: 50%;
      width: 66px;
      height: 120px;
      background: radial-gradient(circle at top, #1f2937, #020617);
      border-radius: 40px 40px 36px 36px;
      transform: translateX(-50%);
      top: 40px;
    }

    .hf-head {
      position: absolute;
      left: 50%;
      width: 42px;
      height: 42px;
      background: radial-gradient(circle at 30% 20%, #64748b, #020617);
      border-radius: 50%;
      transform: translateX(-50%);
      top: 8px;
    }

    .hf-legs {
      position: absolute;
      left: 50%;
      width: 160px;
      height: 80px;
      background: radial-gradient(circle at top, #020617, #000000);
      border-radius: 80px 80px 40px 40px;
      transform: translateX(-50%);
      bottom: 0;
    }

    .hf-arms {
      position: absolute;
      left: 50%;
      width: 180px;
      height: 60px;
      border-radius: 60px;
      border: 18px solid #020617;
      border-top-color: transparent;
      border-left-color: transparent;
      border-right-color: transparent;
      transform: translateX(-50%);
      top: 90px;
      opacity: 0.95;
    }

    .chakra-node {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: var(--chakra-color, #22c55e);
      box-shadow: 0 0 13px rgba(248,250,252,0.9);
      border: 2px solid rgba(15,23,42,0.9);
      cursor: pointer;
      transition: transform 0.18s ease-out, box-shadow 0.18s ease-out, opacity 0.18s;
      opacity: 0.82;
    }
    .chakra-node:hover {
      transform: translateX(-50%) scale(1.1);
      opacity: 1;
    }

    @keyframes chakraPulse {
      0% {
        transform: translateX(-50%) scale(0.95);
        box-shadow: 0 0 10px rgba(248,250,252,0.7);
      }
      50% {
        transform: translateX(-50%) scale(1.25);
        box-shadow: 0 0 24px rgba(248,250,252,0.95);
      }
      100% {
        transform: translateX(-50%) scale(0.95);
        box-shadow: 0 0 10px rgba(248,250,252,0.7);
      }
    }
    .chakra-node.active {
      animation: chakraPulse 2.6s ease-in-out infinite;
      opacity: 1;
    }

    .scheme-row {
      display: flex;
      width: 100%;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 2px;
    }

    .scheme-label {
      font-size: 12px;
      color: var(--text-sub);
    }

    .scheme-buttons {
      display: flex;
      gap: 6px;
    }

    .scheme-btn {
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: var(--text-sub);
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all 0.12s ease-out;
    }
    .scheme-btn span.tag {
      font-size: 11px;
    }
    .scheme-btn.active {
      border-color: var(--accent);
      color: #f9fafb;
      background: radial-gradient(circle at top, #0ea5e9, #020617 70%);
      box-shadow: 0 0 0 1px rgba(56,189,248,0.35);
    }

    .chakra-info-card {
      width: 100%;
      margin-top: 4px;
      padding: 8px 9px 7px;
      border-radius: 14px;
      background: rgba(15,23,42,0.96);
      border: 1px solid #1f2937;
    }
    .chakra-info-title {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3px;
    }
    .chakra-info-chip {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #4f46e5;
      color: #c7d2fe;
      background: rgba(30,64,175,0.35);
    }
    .chakra-info-text {
      font-size: 12px;
      color: var(--text-sub);
      line-height: 1.5;
    }
    .chakra-info-text span.label {
      color: #e5e7eb;
      font-weight: 500;
    }

    /* å‘¼å¸é¡¯ç¤ºå€ */
    .breath-card {
      margin-top: 10px;
      padding: 12px 12px 12px;
      border-radius: 16px;
      background: radial-gradient(circle at top, #020617, #020617);
      border: 1px solid #1e293b;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .breath-circle-wrapper {
      width: 150px;
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .breath-circle {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background: radial-gradient(circle, #020617 0, #020617 40%, #020617 70%);
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow: 0 0 18px rgba(148,163,184,0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e5e7eb;
      font-size: 12px;
      text-align: center;
      padding: 8px;
      transition: transform 0.8s ease-in-out, box-shadow 0.8s ease-in-out, border-color 0.3s ease-out;
      white-space: pre-line;
    }

    .breath-circle.inhale {
      transform: scale(1.23);
      box-shadow: 0 0 26px rgba(34,197,94,0.8);
      border-color: rgba(34,197,94,0.95);
    }
    .breath-circle.hold {
      transform: scale(1.05);
      box-shadow: 0 0 22px rgba(56,189,248,0.85);
      border-color: rgba(56,189,248,0.95);
    }
    .breath-circle.exhale {
      transform: scale(0.85);
      box-shadow: 0 0 22px rgba(248,113,113,0.85);
      border-color: rgba(248,113,113,0.95);
    }

    .breath-status {
      text-align: center;
      font-size: 13px;
    }
    .breath-status-main {
      font-weight: 600;
      margin-bottom: 2px;
    }
    .breath-status-sub {
      font-size: 12px;
      color: var(--text-sub);
    }

    .progress-row {
      margin-top: 4px;
      font-size: 11px;
      color: #9ca3af;
    }

    .controls {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    .btn {
      flex: 1;
      padding: 8px 0;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: var(--text-main);
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all 0.12s ease-out;
    }
    .btn-primary {
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      color: #0f172a;
      border-color: transparent;
      font-weight: 600;
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: none;
    }
    .btn-primary:disabled {
      opacity: 0.55;
    }

    .hint {
      font-size: 11px;
      color: var(--text-sub);
      line-height: 1.5;
      margin-top: 6px;
    }
    .hint strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .total-timer {
      margin-top: 6px;
      font-size: 11px;
      color: #9ca3af;
      text-align: center;
    }

    .footer {
      margin-top: 6px;
      font-size: 10px;
      color: #6b7280;
      text-align: center;
    }

    @media (min-width: 640px) {
      .top-layout {
        flex-direction: row;
        align-items: stretch;
      }
      .figure-card {
        flex: 1.1;
      }
      .breath-card {
        margin-top: 0;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="title">
      <span class="emoji">ğŸŒ€</span>
      <span>è„ˆè¼ªå‘¼å¸å†¥æƒ³å°å·¥å…·</span>
    </div>
    <div class="subtitle">
      å¾æµ·åº•è¼ªä¸€è·¯å¾€ä¸Šï¼Œæ¯å€‹è„ˆè¼ªè·Ÿè‘—å‘¼å¸ 5 è¼ªã€‚é¸ä¸€ç¨®å‘¼å¸æ–¹æ¡ˆå¾ŒæŒ‰é–‹å§‹ï¼Œå…¶ä»–äº¤çµ¦ç¯€å¥å¸¶ä½ èµ°ã€‚
    </div>

    <div class="top-layout">
      <!-- å·¦ï¼šäººå½¢ï¼‹è„ˆè¼ª -->
      <div class="figure-card">
        <div class="scheme-row">
          <div class="scheme-label">å‘¼å¸æ–¹æ¡ˆï¼š</div>
          <div class="scheme-buttons">
            <button class="scheme-btn active" data-scheme="A">
              <span class="tag">A</span>
              <span>å¸4ãƒ»åœ3ãƒ»å4</span>
            </button>
            <button class="scheme-btn" data-scheme="B">
              <span class="tag">B</span>
              <span>å¸4ãƒ»ä¸åœãƒ»å6</span>
            </button>
          </div>
        </div>

        <div class="figure-wrapper">
          <div class="human-figure" id="humanFigure">
            <div class="hf-head"></div>
            <div class="hf-body"></div>
            <div class="hf-legs"></div>
            <div class="hf-arms"></div>
            <!-- è„ˆè¼ªé»å°‡ç”± JS å¡«å…¥ -->
          </div>
        </div>

        <div class="chakra-info-card">
          <div class="chakra-info-title">
            <span id="chakraName">æµ·åº•è¼ªï½œRoot</span>
            <span class="chakra-info-chip" id="chakraKey">å®‰å…¨æ„Ÿãƒ»æ ¹åŸº</span>
          </div>
          <div class="chakra-info-text">
            <div><span class="label">ä½ç½®ï¼š</span><span id="chakraArea">å°¾æ¤ã€éª¨ç›†åº•éƒ¨ã€é›™è…³</span></div>
            <div><span class="label">ç·´ç¿’é‡é»ï¼š</span><span id="chakraHint">æ„Ÿå—èº«é«”é‡é‡ï¼Œå‘¼æ°£æ™‚è®“ç·Šç¹ƒæ…¢æ…¢æ²‰åˆ°åœ°é¢ã€‚</span></div>
          </div>
        </div>
      </div>

      <!-- å³ï¼šå‘¼å¸ç‹€æ…‹ -->
      <div class="breath-card">
        <div class="breath-circle-wrapper">
          <div class="breath-circle" id="breathCircle">
            è·Ÿè‘—æç¤º\nç·©æ…¢å‘¼å¸
          </div>
        </div>
        <div class="breath-status">
          <div class="breath-status-main" id="phaseText">å¾…æ©Ÿä¸­</div>
          <div class="breath-status-sub" id="timerText">
            é¸æ“‡å‘¼å¸æ–¹æ¡ˆå¾ŒæŒ‰é–‹å§‹ï¼Œæœƒè‡ªå‹•å¾æµ·åº•è¼ªå¾€ä¸Šã€‚
          </div>
          <div class="progress-row" id="progressText">
            ç›®å‰å°šæœªé–‹å§‹ã€‚
          </div>
        </div>
      </div>
    </div>

    <!-- æ§åˆ¶æŒ‰éˆ• -->
    <div class="controls">
      <button class="btn btn-primary" id="startBtn">â–¶ï¸ é–‹å§‹</button>
      <button class="btn" id="pauseBtn">â¸ æš«åœ</button>
      <button class="btn" id="resetBtn">ğŸ”„ é‡ç½®</button>
    </div>

    <div class="total-timer" id="totalTimerText">
      ç¸½æ™‚é–“ï¼š00:00 / 00:00
    </div>

    <div class="hint">
      å»ºè­°ï¼š<strong>çœ¼ç›å¾®é–‰</strong>ï¼Œæ³¨æ„åŠ›æ”¾åœ¨ç›®å‰çš„è„ˆè¼ªä½ç½®ã€‚è¦ºå¾—ä¸èˆ’æœæ™‚éš¨æ™‚å¯ä»¥æŒ‰æš«åœæˆ–ç›´æ¥çµæŸï¼Œç¯€å¥åªæ˜¯åƒè€ƒï¼Œä¸éœ€è¦å‹‰å¼·è·Ÿå®Œã€‚
    </div>

    <div class="footer">
      å€‹äººç·´ç¿’ç”¨å°å·¥å…·ï¼Œä¸èƒ½æ›¿ä»£ä»»ä½•é†«ç™‚å»ºè­°ã€‚å¦‚æœ‰èº«é«”ä¸é©ï¼Œè«‹å…ˆåœæ­¢ç·´ç¿’ã€‚
    </div>
  </div>

  <script>
    // ---- è„ˆè¼ªè³‡æ–™ï¼ˆå«åœ¨äººå½¢ä¸Šçš„ä½ç½®ç™¾åˆ†æ¯”ï¼‰----
    const chakras = [
      {
        id: 'root',
        name: 'æµ·åº•è¼ªï½œRoot',
        color: '#ef4444',
        top: '82%',
        area: 'å°¾æ¤ã€éª¨ç›†åº•éƒ¨ã€é›™è…³',
        key: 'å®‰å…¨æ„Ÿãƒ»æ ¹åŸº',
        hint: 'æ„Ÿå—èº«é«”é‡é‡ï¼Œå‘¼æ°£æ™‚è®“ç·Šç¹ƒæ…¢æ…¢æ²‰åˆ°åœ°é¢ã€‚'
      },
      {
        id: 'sacral',
        name: 'è‡è¼ªï½œSacral',
        color: '#f97316',
        top: '72%',
        area: 'è‚šè‡ä¸‹æ–¹ã€å°è…¹',
        key: 'æ„Ÿå—ãƒ»æµå‹•',
        hint: 'å¸æ°£æ™‚è®“å°è…¹åƒæ°£çƒå¾®é¼“ï¼Œåæ°£æ™‚è‡ªç„¶å›åˆ°ä¸­å¿ƒã€‚'
      },
      {
        id: 'solar',
        name: 'å¤ªé™½ç¥ç¶“å¢ï½œSolar Plexus',
        color: '#eab308',
        top: '63%',
        area: 'è‚‹éª¨ä¸­é–“ã€èƒƒéƒ¨é™„è¿‘',
        key: 'è¡Œå‹•ãƒ»ç•Œç·š',
        hint: 'æ„Ÿè¦ºèƒ¸å‰èˆ‡èƒƒéƒ¨å¾®å¾®ç™¼ç†±ï¼Œåæ°£æ™‚æ”¾é¬†å£“åŠ›èˆ‡åƒµç¡¬ã€‚'
      },
      {
        id: 'heart',
        name: 'å¿ƒè¼ªï½œHeart',
        color: '#22c55e',
        top: '52%',
        area: 'èƒ¸å£ä¸­å¤®ã€è‚©è†€',
        key: 'é€£çµãƒ»åŒ…å®¹',
        hint: 'è·Ÿè‘—èƒ¸å£èµ·ä¼ï¼Œå¸æ°£æ™‚èƒ¸è…”å±•é–‹ï¼Œåæ°£æ™‚è‚©è†€ä¸€èµ·é¬†ä¸‹ä¾†ã€‚'
      },
      {
        id: 'throat',
        name: 'å–‰è¼ªï½œThroat',
        color: '#0ea5e9',
        top: '41%',
        area: 'å–‰åš¨ã€é ¸éƒ¨',
        key: 'è¡¨é”ãƒ»çœŸå¯¦',
        hint: 'ç•™æ„å‘¼å¸ç¶“éå–‰åš¨çš„æ„Ÿè¦ºï¼Œè®“é ¸éƒ¨ç¶­æŒæŸ”è»Ÿä¸ç”¨å‡ºåŠ›ã€‚'
      },
      {
        id: 'third-eye',
        name: 'çœ‰å¿ƒè¼ªï½œThird Eye',
        color: '#6366f1',
        top: '30%',
        area: 'å…©çœ‰ä¹‹é–“ã€çœ¼å‘¨',
        key: 'å°ˆæ³¨ãƒ»æ´å¯Ÿ',
        hint: 'è¼•è¼•æŠŠæ³¨æ„åŠ›åœåœ¨å…©çœ‰ä¹‹é–“ï¼Œä»»ç”±å¿µé ­ç¶“éï¼Œä¸å¿…è¿½è‘—è·‘ã€‚'
      },
      {
        id: 'crown',
        name: 'é ‚è¼ªï½œCrown',
        color: '#a855f7',
        top: '18%',
        area: 'é ­é ‚ã€é ­çš®',
        key: 'è¦ºå¯Ÿãƒ»é–‹å±•',
        hint: 'æƒ³åƒé ­é ‚ä¸Šæ–¹æœ‰ä¸€å€‹å¯¬å»£ç©ºé–“ï¼Œå‘¼å¸åœ¨é‚£è£¡ç·©æ…¢åœ°èµ·ä¼ã€‚'
      }
    ];

    // ---- å‘¼å¸æ–¹æ¡ˆ ----
    const SCHEMES = {
      A: { id: 'A', label: 'Aæ–¹æ¡ˆï½œå¸4ãƒ»åœ3ãƒ»å4', inhale: 4, hold: 3, exhale: 4 },
      B: { id: 'B', label: 'Bæ–¹æ¡ˆï½œå¸4ãƒ»ä¸åœãƒ»å6', inhale: 4, hold: 0, exhale: 6 }
    };

    const cyclesPerChakra = 5;

    // ---- DOM ----
    const humanFigureEl = document.getElementById('humanFigure');
    const chakraNameEl = document.getElementById('chakraName');
    const chakraKeyEl = document.getElementById('chakraKey');
    const chakraAreaEl = document.getElementById('chakraArea');
    const chakraHintEl = document.getElementById('chakraHint');

    const schemeButtons = document.querySelectorAll('.scheme-btn');

    const breathCircleEl = document.getElementById('breathCircle');
    const phaseTextEl = document.getElementById('phaseText');
    const timerTextEl = document.getElementById('timerText');
    const progressTextEl = document.getElementById('progressText');
    const totalTimerTextEl = document.getElementById('totalTimerText');

    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');

    // ---- ç‹€æ…‹ ----
    let currentSchemeId = 'A';
    let inhaleSeconds = SCHEMES[currentSchemeId].inhale;
    let holdSeconds = SCHEMES[currentSchemeId].hold;
    let exhaleSeconds = SCHEMES[currentSchemeId].exhale;

    let isRunning = false;
    let hasFinished = false;
    let timer = null;

    const PHASES = {
      INHALE: 'INHALE',
      HOLD: 'HOLD',
      EXHALE: 'EXHALE'
    };

    let currentPhase = PHASES.INHALE;
    let phaseRemaining = inhaleSeconds;

    let currentChakraIndex = 0;
    let cycleCountWithinChakra = 0;

    let elapsedSeconds = 0;
    let totalSeconds = calcTotalSeconds();

    // ---- åˆå§‹åŒ–äººå½¢è„ˆè¼ªé» ----
    function renderChakraNodes() {
      chakras.forEach((chakra, index) => {
        const dot = document.createElement('button');
        dot.type = 'button';
        dot.className = 'chakra-node';
        dot.style.setProperty('--chakra-color', chakra.color);
        dot.style.top = chakra.top;
        dot.dataset.index = index.toString();

        dot.addEventListener('click', () => {
          if (isRunning) return; // é¿å…ä¸­é€”äº‚è·³
          currentChakraIndex = index;
          cycleCountWithinChakra = 0;
          updateChakraInfo();
          updateActiveChakraDot();
          updateProgressText();
        });

        humanFigureEl.appendChild(dot);
      });
      updateActiveChakraDot();
    }

    function updateActiveChakraDot() {
      const dots = humanFigureEl.querySelectorAll('.chakra-node');
      dots.forEach(dot => {
        const idx = parseInt(dot.dataset.index || '0', 10);
        dot.classList.toggle('active', idx === currentChakraIndex && !hasFinished);
      });
    }

    // ---- æ›´æ–°è„ˆè¼ªè³‡è¨Š ----
    function updateChakraInfo() {
      const chakra = chakras[currentChakraIndex];
      chakraNameEl.textContent = chakra.name;
      chakraKeyEl.textContent = chakra.key;
      chakraAreaEl.textContent = chakra.area;
      chakraHintEl.textContent = chakra.hint;
    }

    // ---- å‘¼å¸æ–¹æ¡ˆ ----
    function setScheme(id) {
      currentSchemeId = id;
      const scheme = SCHEMES[id];
      inhaleSeconds = scheme.inhale;
      holdSeconds = scheme.hold;
      exhaleSeconds = scheme.exhale;

      totalSeconds = calcTotalSeconds();
      resetSession(false); // ä¸æ¸…é™¤æ–¹æ¡ˆï¼Œä½†é‡ä¾†
      updateSchemeButtons();
    }

    function updateSchemeButtons() {
      schemeButtons.forEach(btn => {
        const id = btn.dataset.scheme;
        btn.classList.toggle('active', id === currentSchemeId);
      });
    }

    function calcTotalSeconds() {
      const scheme = SCHEMES[currentSchemeId];
      const cycle = scheme.inhale + scheme.hold + scheme.exhale;
      return cycle * cyclesPerChakra * chakras.length;
    }

    // ---- å‘¼å¸æµç¨‹ ----
    function startSession() {
      if (isRunning) return;

      if (hasFinished) {
        resetSession(false);
      }
      isRunning = true;
      startBtn.disabled = true;

      if (!timer) {
        currentPhase = PHASES.INHALE;
        phaseRemaining = inhaleSeconds;
      }

      updatePhaseUI();

      timer = setInterval(() => {
        // æ¯ç§’æ›´æ–°
        if (phaseRemaining <= 0) {
          const switched = switchPhaseOrChakra();
          if (!switched) {
            // å…¨éƒ¨å®Œæˆ
            finishSession();
            return;
          }
        } else {
          phaseRemaining -= 1;
          elapsedSeconds += 1;
          updateTimerText();
          updateTotalTimerText();
        }
      }, 1000);
    }

    function pauseSession() {
      if (!isRunning) return;
      isRunning = false;
      startBtn.disabled = false;
      if (timer) {
        clearInterval(timer);
        timer = null;
      }
      phaseTextEl.textContent = 'å·²æš«åœ';
      timerTextEl.textContent = 'éš¨æ™‚å¯ä»¥å†æŒ‰é–‹å§‹ï¼Œæœƒå¾ç›®å‰çš„éšæ®µæ¥çºŒã€‚';
      breathCircleEl.classList.remove('inhale', 'hold', 'exhale');
    }

    function resetSession(clearScheme = false) {
      isRunning = false;
      hasFinished = false;
      startBtn.disabled = false;
      if (timer) {
        clearInterval(timer);
        timer = null;
      }

      if (clearScheme) {
        currentSchemeId = 'A';
        inhaleSeconds = SCHEMES.A.inhale;
        holdSeconds = SCHEMES.A.hold;
        exhaleSeconds = SCHEMES.A.exhale;
        updateSchemeButtons();
      }

      currentPhase = PHASES.INHALE;
      phaseRemaining = inhaleSeconds;
      currentChakraIndex = 0;
      cycleCountWithinChakra = 0;
      elapsedSeconds = 0;
      totalSeconds = calcTotalSeconds();

      phaseTextEl.textContent = 'å¾…æ©Ÿä¸­';
      timerTextEl.textContent = 'é¸æ“‡å‘¼å¸æ–¹æ¡ˆå¾ŒæŒ‰é–‹å§‹ï¼Œæœƒè‡ªå‹•å¾æµ·åº•è¼ªå¾€ä¸Šã€‚';
      progressTextEl.textContent = 'ç›®å‰å°šæœªé–‹å§‹ã€‚';

      breathCircleEl.classList.remove('inhale', 'hold', 'exhale');
      breathCircleEl.textContent = 'è·Ÿè‘—æç¤º\nç·©æ…¢å‘¼å¸';

      updateChakraInfo();
      updateActiveChakraDot();
      updateTotalTimerText();
    }

    function finishSession() {
      isRunning = false;
      hasFinished = true;
      startBtn.disabled = false;
      if (timer) {
        clearInterval(timer);
        timer = null;
      }
      breathCircleEl.classList.remove('inhale', 'hold', 'exhale');
      breathCircleEl.textContent = 'å…¨è„ˆè¼ª\nç·´ç¿’å®Œæˆ';
      phaseTextEl.textContent = 'å·²å®Œæˆå…¨è„ˆè¼ªç·´ç¿’';
      timerTextEl.textContent = 'å¯ä»¥ä¼‘æ¯ä¸€ä¸‹ï¼Œæˆ–æŒ‰é‡ç½®å†å¾æµ·åº•è¼ªé–‹å§‹ã€‚';
      updateProgressText();
      updateActiveChakraDot();
      if (elapsedSeconds < totalSeconds) {
        elapsedSeconds = totalSeconds;
        updateTotalTimerText();
      }
    }

    // åœ¨æ¯æ¬¡ EXHALE çµæŸæ™‚åˆ¤æ–·è¦ä¸è¦æ›è„ˆè¼ªï¼çµæŸ
    function switchPhaseOrChakra() {
      if (currentPhase === PHASES.INHALE) {
        if (holdSeconds > 0) {
          currentPhase = PHASES.HOLD;
          phaseRemaining = holdSeconds;
        } else {
          currentPhase = PHASES.EXHALE;
          phaseRemaining = exhaleSeconds;
        }
      } else if (currentPhase === PHASES.HOLD) {
        currentPhase = PHASES.EXHALE;
        phaseRemaining = exhaleSeconds;
      } else if (currentPhase === PHASES.EXHALE) {
        // å–®ä¸€å®Œæˆå‘¼å¸å¾ªç’°
        cycleCountWithinChakra += 1;

        if (cycleCountWithinChakra >= cyclesPerChakra) {
          // æ›è„ˆè¼ª
          cycleCountWithinChakra = 0;
          if (currentChakraIndex < chakras.length - 1) {
            currentChakraIndex += 1;
            updateChakraInfo();
            updateActiveChakraDot();
          } else {
            // æ‰€æœ‰è„ˆè¼ªå®Œæˆ
            return false;
          }
        }
        currentPhase = PHASES.INHALE;
        phaseRemaining = inhaleSeconds;
      }

      elapsedSeconds += 1;
      updatePhaseUI();
      updateTotalTimerText();
      return true;
    }

    function updatePhaseUI() {
      breathCircleEl.classList.remove('inhale', 'hold', 'exhale');

      if (currentPhase === PHASES.INHALE) {
        phaseTextEl.textContent = 'å¸æ°£';
        breathCircleEl.classList.add('inhale');
        breathCircleEl.textContent = 'é¼»å­å¸æ°£\nç·©æ…¢å¸æ»¿';
      } else if (currentPhase === PHASES.HOLD) {
        phaseTextEl.textContent = 'åœç•™';
        breathCircleEl.classList.add('hold');
        breathCircleEl.textContent = 'æš«æ™‚ä¸å‹•\nåªè§€å¯Ÿèº«é«”æ„Ÿå—';
      } else if (currentPhase === PHASES.EXHALE) {
        phaseTextEl.textContent = 'åæ°£';
        breathCircleEl.classList.add('exhale');
        breathCircleEl.textContent = 'å˜´å·´æˆ–é¼»å­åæ°£\næŠŠå¤šé¤˜çš„åŠ›é‡æ”¾æ‰';
      }

      updateTimerText();
      updateProgressText();
    }

    function updateTimerText() {
      timerTextEl.textContent = `æœ¬éšæ®µå‰©é¤˜ ${phaseRemaining} ç§’`;
    }

    function updateProgressText() {
      const chakra = chakras[currentChakraIndex];
      const finishedChakras = currentChakraIndex;
      const totalChakras = chakras.length;

      if (hasFinished) {
        progressTextEl.textContent = `å·²å®Œæˆ ${totalChakras}/${totalChakras} å€‹è„ˆè¼ªã€æ¯å€‹ 5 è¼ªå‘¼å¸ã€‚`;
        return;
      }

      if (!isRunning && elapsedSeconds === 0) {
        progressTextEl.textContent = 'ç›®å‰å°šæœªé–‹å§‹ã€‚';
        return;
      }

      progressTextEl.textContent =
        `æ­£åœ¨ç¬¬ ${currentChakraIndex + 1}/${totalChakras} å€‹è„ˆè¼ªï¼š${chakra.name}ï½œæœ¬è¼ªå·²å®Œæˆ ${cycleCountWithinChakra}/${cyclesPerChakra} æ¬¡å‘¼å¸ã€‚`;
    }

    function updateTotalTimerText() {
      const format = (s) => {
        const m = Math.floor(s / 60);
        const sec = s % 60;
        const mm = String(m).padStart(2, '0');
        const ss = String(sec).padStart(2, '0');
        return `${mm}:${ss}`;
      };
      totalTimerTextEl.textContent = `ç¸½æ™‚é–“ï¼š${format(elapsedSeconds) } / ${format(totalSeconds)}`;
    }

    // ---- äº‹ä»¶ç¶å®š ----
    startBtn.addEventListener('click', startSession);
    pauseBtn.addEventListener('click', pauseSession);
    resetBtn.addEventListener('click', () => resetSession(false));

    schemeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.scheme;
        if (id && id !== currentSchemeId) {
          setScheme(id);
        }
      });
    });

    // ---- åˆå§‹åŒ– ----
    function init() {
      renderChakraNodes();
      updateChakraInfo();
      updateSchemeButtons();
      updateTotalTimerText();
    }

    init();
  </script>
</body>
</html>
