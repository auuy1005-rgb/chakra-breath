<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <title>æ—¥æ–‡å­¸ç¿’å¡ç‰‡ï½œMaLana</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #71aac5;
        color: #222;
      }

      .app-header {
        padding: 1.2rem 1.5rem;
        background: #303f9f;
        color: #fff;
      }

      .app-header h1 {
        margin: 0 0 0.25rem;
        font-size: 1.4rem;
      }

      .app-main {
        max-width: 800px;
        margin: 1.5rem auto;
        padding: 0 1rem 2rem;
      }

.controls {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        align-items: center;
        margin-bottom: 1rem;
      }

      .controls select,
      .controls button {
        padding: 0.4rem 0.6rem;
        font-size: 0.95rem;
      }

      .card {
        background: #fff;
        border-radius: 12px;
        padding: 1.2rem 1.4rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        margin-bottom: 1rem;
      }

      .card-lesson {
        font-size: 0.85rem;
        color: #666;
      }

      .card-type {
        font-size: 0.8rem;
        color: #999;
        margin-bottom: 0.5rem;
      }

      .card-jp {
        font-size: 1.4rem;
        color: #444;
        margin-bottom: 0.4rem;
      }

      .card-kana {
        font-size: 1.8rem;
        color: #000000;
        margin-top: 0.2rem;
        margin-bottom: 1.5rem;
      }

      .card-romaji {
        font-size: 0.8rem;
        color: #aaaaaa;
        margin-bottom: 0.25rem;
      }

      .card-zh {
        font-size: 0.8rem;
        color:#aaaaaa;
        margin-bottom: 0.25rem;
      }

      .card-note {
        font-size: 0.85rem;
        color: #888;
        margin-bottom: 0.6rem;
      }

      .card-actions {
        margin-bottom: 0.6rem;
      }

      .card-actions button {
        padding: 0.35rem 0.8rem;
        font-size: 0.9rem;
      }

      .card-stars {
        font-size: 0.9rem;
      }

      .card-stars .star {
        cursor: pointer;
        font-size: 1.8rem;
        margin-left: 0.25rem;
        color: #ccc;
        padding: 0.15rem 0.35rem;
        display: inline-block;
      }

      .card-stars .star.active {
        color: #ffb300;
      }

      .progress {
        font-size: 0.9rem;
        color: #555;
      }

      #cycleStatus {
        margin-top: 0.3rem;
        font-weight: 600;
      }

      .app-footer {
        text-align: center;
        padding: 0.8rem 1rem 1.2rem;
        font-size: 0.75rem;
        color: #777;
      }

      @media (max-width: 480px) {
        .card-jp {
          font-size: 1.4rem;
        }
      }
/* --- é‡è¨­æŒ‰éˆ•å›ºå®šåœ¨å³ä¸‹è§’ï¼ˆç™½å¡å¤–ï¼‰ --- */
.reset-fixed {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 999;
}

.reset-fixed button {
    padding: 0.8rem 1.2rem;
    font-size: 1rem;
}

#nextBtn {
    padding: 2rem 2.2rem; /* ä¸Šä¸‹ã€å·¦å³å…§è· */
    font-size: 1rem;
    min-width: 300px;      /* â˜…â˜…â˜… é€™è¡Œå°±æ˜¯åŠ å¯¬æŒ‰éˆ•çš„é—œéµ â˜…â˜…â˜… */
    text-align: center;
}

    </style>
  </head>
  <body>
    <header class="app-header">
      <h1>æ—¥æ–‡å­¸ç¿’å¡ç‰‡</h1>
      <p>éš¨æ©ŸæŠ½å¡ï¼‹æ˜Ÿæ˜Ÿé›£åº¦ï¼‹ç™¼éŸ³ ğŸ”Š</p>
    </header>

    <main class="app-main">
      <section class="controls">
  <label>
    é¸æ“‡èª²ç¨‹ï¼š
    <select id="lessonSelect">
      <option value="all">å…¨éƒ¨èª²ç¨‹ï¼ˆéš¨æ©Ÿï¼‰</option>
      <!-- JS æœƒè‡ªå‹•å¡å…¥èª²ç¨‹ -->
    </select>
  </label>

  <button id="nextBtn">æŠ½ä¸‹ä¸€å¼µå¡ç‰‡ ğŸ´</button>
 

  <!-- â­â­â­ æŠŠæ˜Ÿæ˜Ÿç§»åˆ°é€™è£¡ â­â­â­ -->
  <div class="card-stars" style="margin-top: 0.6rem;">
    é›£åº¦ï¼š
    <span class="star" data-star="1">â˜…</span>
    <span class="star" data-star="2">â˜…</span>
    <span class="star" data-star="3">â˜…</span>
  </div>
</section>

<section class="card" id="card">
  <div class="card-lesson" id="cardLesson"></div>
  <div class="card-type" id="cardType"></div>

  <div class="card-jp" id="cardJp">è«‹å…ˆæŒ‰ã€ŒæŠ½ä¸‹ä¸€å¼µå¡ç‰‡ã€</div>
  <div class="card-kana" id="cardKana"></div>
  <div class="card-romaji" id="cardRomaji"></div>
  <div class="card-zh" id="cardZh"></div>
  <div class="card-note" id="cardNote"></div>

<div class="reset-fixed">
    <button id="resetCycleBtn">é‡è¨­å­¸ç¿’å¾ªç’°</button>
</div>

  <div class="card-actions">
    <button id="audioBtn">ğŸ”Š ç™¼éŸ³</button>
  </div>
</section>

      <section class="progress">
        <div id="cycleProgressText">æœ¬å¾ªç’°é€²åº¦ï¼š0 / 0</div>
        <div id="cycleStatus"></div>
      </section>
    </main>

    <footer class="app-footer">
      <small>å­¸ç¿’ç´€éŒ„å­˜åœ¨ç€è¦½å™¨ localStorageï¼Œä¸æœƒè¢«æ´—æ‰ âœ¨</small>
    </footer>

    <!-- ====== é€™ä¸€æ®µï¼šä½ çš„ 1ï½13 èª²å¡ç‰‡è³‡æ–™ ====== -->
    <script>
      const lessons = [
        {
          lessonId: 1,
          title: "ç¬¬1èª²ï½œãªã«ã‚’ã—ã¦ã„ã¾ã™ã‹",
          cards: [
            {
              type: "sentence",
              jp: "ãªã«ã‚’ ã—ã¦ã„ã‚‹ã®ã€‚",
              kana: "ãªã«ã‚’ ã—ã¦ã„ã‚‹ã®ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãªã«ã‚’ ã—ã¦ã„ã‚‹ã®ã€‚"
            },
            {
              type: "sentence",
              jp: "ãªã«ã‚’ ã—ã¦ã„ã¾ã™ã‹ã€‚",
              kana: "ãªã«ã‚’ ã—ã¦ã„ã¾ã™ã‹ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãªã«ã‚’ ã—ã¦ã„ã¾ã™ã‹ã€‚"
            }
          ]
        },
        {
          lessonId: 2,
          title: "ç¬¬2èª²ï½œãªã«ã‚’ã—ã¦ã„ã¾ã™ã‹ï¼ˆã”ã¯ã‚“ãƒ»ãƒãƒŠãƒŠï¼‰",
          cards: [
            {
              type: "sentence",
              jp: "ãªã«ã‚’ ã—ã¦ã„ã‚‹ã®ã€‚",
              kana: "ãªã«ã‚’ ã—ã¦ã„ã‚‹ã®ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãªã«ã‚’ ã—ã¦ã„ã‚‹ã®ã€‚"
            },
            {
              type: "sentence",
              jp: "ã‚ã•ã”ã¯ã‚“ ã‚’ ãŸã¹ã¦ã„ã¾ã™ã€‚",
              kana: "ã‚ã•ã”ã¯ã‚“ ã‚’ ãŸã¹ã¦ã„ã¾ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã‚ã•ã”ã¯ã‚“ ã‚’ ãŸã¹ã¦ã„ã¾ã™ã€‚"
            },
            {
              type: "sentence",
              jp: "ãªã«ã‚’ ã—ã¦ã„ã‚‹ã®ã€‚",
              kana: "ãªã«ã‚’ ã—ã¦ã„ã‚‹ã®ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãªã«ã‚’ ã—ã¦ã„ã‚‹ã®ã€‚"
            },
            {
              type: "sentence",
              jp: "ãƒãƒŠãƒŠ ã‚’ ãŸã¹ã¦ã„ã¾ã™ã€‚",
              kana: "ãƒãƒŠãƒŠ ã‚’ ãŸã¹ã¦ã„ã¾ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãƒãƒŠãƒŠ ã‚’ ãŸã¹ã¦ã„ã¾ã™ã€‚"
            }
          ]
        },
        {
          lessonId: 3,
          title: "ç¬¬3èª²ï½œã“ã‚Œã¯ãªã‚“ã§ã™ã‹",
          cards: [
            {
              type: "sentence",
              jp: "ã“ã‚Œã¯ãªã‚“ã ã€‚",
              kana: "ã“ã‚Œã¯ãªã‚“ã ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã“ã‚Œã¯ãªã‚“ã ã€‚"
            },
            {
              type: "sentence",
              jp: "ãƒãƒŠãƒŠã§ã™ã€‚",
              kana: "ãƒãƒŠãƒŠã§ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãƒãƒŠãƒŠã§ã™ã€‚"
            },
            {
              type: "sentence",
              jp: "ã“ã‚Œã¯ãªã‚“ã§ã™ã‹ã€‚",
              kana: "ã“ã‚Œã¯ãªã‚“ã§ã™ã‹ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã“ã‚Œã¯ãªã‚“ã§ã™ã‹ã€‚"
            },
            {
              type: "sentence",
              jp: "ãƒãƒŠãƒŠã§ã™ã€‚",
              kana: "ãƒãƒŠãƒŠã§ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãƒãƒŠãƒŠã§ã™ã€‚"
            },
            {
              type: "sentence",
              jp: "ã“ã‚Œã¯ãªã«ã‹ãªã€‚",
              kana: "ã“ã‚Œã¯ãªã«ã‹ãªã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã“ã‚Œã¯ãªã«ã‹ãªã€‚"
            },
            {
              type: "sentence",
              jp: "ã“ã‚Œã¯ãƒãƒŠãƒŠã ã€‚",
              kana: "ã“ã‚Œã¯ãƒãƒŠãƒŠã ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã“ã‚Œã¯ãƒãƒŠãƒŠã ã€‚"
            },
            {
              type: "sentence",
              jp: "ã“ã‚Œã¯ãªã‚“ã ã‚ã†ã€‚",
              kana: "ã“ã‚Œã¯ãªã‚“ã ã‚ã†ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã“ã‚Œã¯ãªã‚“ã ã‚ã†ã€‚"
            },
            {
              type: "sentence",
              jp: "ã“ã‚Œã¯ãƒãƒŠãƒŠã€‚",
              kana: "ã“ã‚Œã¯ãƒãƒŠãƒŠã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã“ã‚Œã¯ãƒãƒŠãƒŠã€‚"
            }
          ]
        },
        {
          lessonId: 4,
          title: "ç¬¬4èª²ï½œã©ã“ã§ã™ã‹",
          cards: [
            {
              type: "sentence",
              jp: "ã“ã®ã‚¹ã‚­ãƒ¼ã˜ã‚‡ã†ã¯ã©ã“ã§ã™ã‹ã€‚",
              kana: "ã“ã®ã‚¹ã‚­ãƒ¼ã˜ã‚‡ã†ã¯ã©ã“ã§ã™ã‹ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã“ã®ã‚¹ã‚­ãƒ¼ã˜ã‚‡ã†ã¯ã©ã“ã§ã™ã‹ã€‚"
            },
            {
              type: "sentence",
              jp: "ã“ã®ãƒ›ãƒ†ãƒ«ã¯ã©ã“ã§ã™ã‹ã€‚",
              kana: "ã“ã®ãƒ›ãƒ†ãƒ«ã¯ã©ã“ã§ã™ã‹ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã“ã®ãƒ›ãƒ†ãƒ«ã¯ã©ã“ã§ã™ã‹ã€‚"
            },
            {
              type: "sentence",
              jp: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ã€‚",
              kana: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ã€‚"
            },
            {
              type: "sentence",
              jp: "ã‘ã„ãŸã„ã¯ã©ã“ã€‚",
              kana: "ã‘ã„ãŸã„ã¯ã©ã“ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã‘ã„ãŸã„ã¯ã©ã“ã€‚"
            },
            {
              type: "sentence",
              jp: "ãƒã‚¹ã‚¯ã¯ã©ã“ã€‚",
              kana: "ãƒã‚¹ã‚¯ã¯ã©ã“ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãƒã‚¹ã‚¯ã¯ã©ã“ã€‚"
            }
          ]
        },
        {
          lessonId: 5,
          title: "ç¬¬5èª²ï½œã“ã“ã ",
          cards: [
            {
              type: "sentence",
              jp: "ã“ã“ã ã€‚",
              kana: "ã“ã“ã ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã“ã“ã ã€‚"
            },
            {
              type: "sentence",
              jp: "ã“ã“ã§ã™ã€‚",
              kana: "ã“ã“ã§ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã“ã“ã§ã™ã€‚"
            },
            {
              type: "sentence",
              jp: "ãŠã­ãˆã•ã‚“ã€ã©ã“ã‹ãªã€‚",
              kana: "ãŠã­ãˆã•ã‚“ã€ã©ã“ã‹ãªã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãŠã­ãˆã•ã‚“ã€ã©ã“ã‹ãªã€‚"
            },
            {
              type: "sentence",
              jp: "ãƒãƒŠãƒŠã¯ã©ã“ã€‚",
              kana: "ãƒãƒŠãƒŠã¯ã©ã“ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãƒãƒŠãƒŠã¯ã©ã“ã€‚"
            }
          ]
        },
        {
          lessonId: 6,
          title: "ç¬¬6èª²ï½œãŠã‚ã§ã¨ã†",
          cards: [
            {
              type: "sentence",
              jp: "ãŠãŸã‚“ã˜ã‚‡ã†ã³ã€ãŠã‚ã§ã¨ã†ã€‚",
              kana: "ãŠãŸã‚“ã˜ã‚‡ã†ã³ã€ãŠã‚ã§ã¨ã†ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãŠãŸã‚“ã˜ã‚‡ã†ã³ã€ãŠã‚ã§ã¨ã†ã€‚"
            },
            {
              type: "sentence",
              jp: "ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚",
              kana: "ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚"
            },
            {
              type: "sentence",
              jp: "ã—ã‚…ã£ã•ã‚“ã€ãŠã‚ã§ã¨ã†ã€‚",
              kana: "ã—ã‚…ã£ã•ã‚“ã€ãŠã‚ã§ã¨ã†ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã—ã‚…ã£ã•ã‚“ã€ãŠã‚ã§ã¨ã†ã€‚"
            }
          ]
        },
        {
          lessonId: 7,
          title: "ç¬¬7èª²ï½œã©ã†ã—ãŸã®",
          cards: [
            {
              type: "sentence",
              jp: "ã©ã†ã—ãŸã®ï¼Ÿ",
              kana: "ã©ã†ã—ãŸã®ï¼Ÿ",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã©ã†ã—ãŸã®ï¼Ÿ"
            },
            {
              type: "sentence",
              jp: "ã©ã†ã—ã¾ã—ãŸã‹ï¼Ÿ",
              kana: "ã©ã†ã—ã¾ã—ãŸã‹ï¼Ÿ",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã©ã†ã—ã¾ã—ãŸã‹ï¼Ÿ"
            },
            {
              type: "sentence",
              jp: "ã¡ã‚‡ã£ã¨ã¤ã‹ã‚ŒãŸã€‚",
              kana: "ã¡ã‚‡ã£ã¨ã¤ã‹ã‚ŒãŸã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã¡ã‚‡ã£ã¨ã¤ã‹ã‚ŒãŸã€‚"
            }
          ]
        },
        {
          lessonId: 8,
          title: "ç¬¬8èª²ï½œã„ãŸã„",
          cards: [
            {
              type: "sentence",
              jp: "ã„ãŸã„ã€‚",
              kana: "ã„ãŸã„ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã„ãŸã„ã€‚"
            },
            {
              type: "sentence",
              jp: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã‹ã€‚",
              kana: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã‹ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã‹ã€‚"
            },
            {
              type: "sentence",
              jp: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã€‚",
              kana: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã€‚"
            },
            {
              type: "sentence",
              jp: "ã„ãŸã„ã€‚",
              kana: "ã„ãŸã„ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã„ãŸã„ã€‚"
            },
            {
              type: "sentence",
              jp: "ã©ã†ã—ãŸã®ã€‚",
              kana: "ã©ã†ã—ãŸã®ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã©ã†ã—ãŸã®ã€‚"
            },
            {
              type: "sentence",
              jp: "ã‚ã— ã‚’ ã¶ã¤ã‘ã¦ ã—ã¾ã„ã¾ã—ãŸã€‚",
              kana: "ã‚ã— ã‚’ ã¶ã¤ã‘ã¦ ã—ã¾ã„ã¾ã—ãŸã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã‚ã— ã‚’ ã¶ã¤ã‘ã¦ ã—ã¾ã„ã¾ã—ãŸã€‚"
            },
            {
              type: "sentence",
              jp: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã‹ã€‚",
              kana: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã‹ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã‹ã€‚"
            },
            {
              type: "sentence",
              jp: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã€‚",
              kana: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã ã„ã˜ã‚‡ã†ã¶ã§ã™ã€‚"
            }
          ]
        },
        {
          lessonId: 9,
          title: "ç¬¬9èª²ï½œãŠã‚„ã™ã¿",
          cards: [
            {
              type: "sentence",
              jp: "ãŠã‚„ã™ã¿ã€‚",
              kana: "ãŠã‚„ã™ã¿ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãŠã‚„ã™ã¿ã€‚"
            },
            {
              type: "sentence",
              jp: "ãŠã‚„ã™ã¿ãªã•ã„ã€‚",
              kana: "ãŠã‚„ã™ã¿ãªã•ã„ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãŠã‚„ã™ã¿ãªã•ã„ã€‚"
            }
          ]
        },
        {
          lessonId: 10,
          title: "ç¬¬10èª²ï½œï½ã€ãŠé¡˜ã„ã—ã¾ã™",
          cards: [
            {
              type: "sentence",
              jp: "ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚",
              kana: "ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚"
            },
            {
              type: "sentence",
              jp: "ãŠã«ãã‚Šã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚",
              kana: "ãŠã«ãã‚Šã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãŠã«ãã‚Šã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚"
            },
            {
              type: "sentence",
              jp: "ãŠã‹ã„ã‘ã„ã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚",
              kana: "ãŠã‹ã„ã‘ã„ã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãŠã‹ã„ã‘ã„ã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚"
            }
          ]
        },
        {
          lessonId: 11,
          title: "ç¬¬11èª²ï½œã©ã£ã¡ãŒã„ã„ã§ã™ã‹",
          cards: [
            {
              type: "sentence",
              jp: "ã‚³ãƒ¼ãƒ’ãƒ¼ã¨ ãŠã¡ã‚ƒã€ ã©ã£ã¡ãŒ ã„ã„ã§ã™ã‹ã€‚",
              kana: "ã‚³ãƒ¼ãƒ’ãƒ¼ã¨ ãŠã¡ã‚ƒã€ ã©ã£ã¡ãŒ ã„ã„ã§ã™ã‹ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã‚³ãƒ¼ãƒ’ãƒ¼ã¨ ãŠã¡ã‚ƒã€ ã©ã£ã¡ãŒ ã„ã„ã§ã™ã‹ã€‚"
            },
            {
              type: "sentence",
              jp: "ã‚³ãƒ¼ãƒ’ãƒ¼ã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚",
              kana: "ã‚³ãƒ¼ãƒ’ãƒ¼ã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã‚³ãƒ¼ãƒ’ãƒ¼ã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚"
            },
            {
              type: "sentence",
              jp: "ãŠã¡ã‚ƒã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚",
              kana: "ãŠã¡ã‚ƒã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãŠã¡ã‚ƒã€ ãŠã­ãŒã„ã—ã¾ã™ã€‚"
            },
            {
              type: "sentence",
              jp: "ãªãŒã„ ã¤ã‚Šã–ãŠ ã¨ ã¿ã˜ã‹ã„ ã¤ã‚Šã–ãŠã€ ã©ã£ã¡ãŒ ã„ã„ï¼Ÿ",
              kana: "ãªãŒã„ ã¤ã‚Šã–ãŠ ã¨ ã¿ã˜ã‹ã„ ã¤ã‚Šã–ãŠã€ ã©ã£ã¡ãŒ ã„ã„ï¼Ÿ",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãªãŒã„ ã¤ã‚Šã–ãŠ ã¨ ã¿ã˜ã‹ã„ ã¤ã‚Šã–ãŠã€ ã©ã£ã¡ãŒ ã„ã„ï¼Ÿ"
            },
            {
              type: "sentence",
              jp: "ã©ã£ã¡ãŒ ã„ã„ï¼Ÿ",
              kana: "ã©ã£ã¡ãŒ ã„ã„ï¼Ÿ",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã©ã£ã¡ãŒ ã„ã„ï¼Ÿ"
            },
            {
              type: "sentence",
              jp: "ã“ã£ã¡ã€‚",
              kana: "ã“ã£ã¡ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã“ã£ã¡ã€‚"
            }
          ]
        },
        {
          lessonId: 12,
          title: "ç¬¬12èª²ï½œãã‚‰ã¹ã¦ã¿ã‚ˆã†",
          cards: [
            {
              type: "sentence",
              jp: "ã©ã£ã¡ ãŒ ãŸã‹ã„ ã‹ãªã€‚",
              kana: "ã©ã£ã¡ ãŒ ãŸã‹ã„ ã‹ãªã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã©ã£ã¡ ãŒ ãŸã‹ã„ ã‹ãªã€‚"
            },
            {
              type: "sentence",
              jp: "ãã‚‰ã¹ã¦ ã¿ã‚ˆã†ã€‚",
              kana: "ãã‚‰ã¹ã¦ ã¿ã‚ˆã†ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãã‚‰ã¹ã¦ ã¿ã‚ˆã†ã€‚"
            },
            {
              type: "sentence",
              jp: "ã‚ã£ã¡ãŒ ãŸã‹ãã¦ã€ ã“ã£ã¡ãŒ ã²ãã„ã€‚",
              kana: "ã‚ã£ã¡ãŒ ãŸã‹ãã¦ã€ ã“ã£ã¡ãŒ ã²ãã„ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã‚ã£ã¡ãŒ ãŸã‹ãã¦ã€ ã“ã£ã¡ãŒ ã²ãã„ã€‚"
            },
            {
              type: "sentence",
              jp: "ã©ã£ã¡ ãŒ ãªãŒã„ ã‹ãªã€‚",
              kana: "ã©ã£ã¡ ãŒ ãªãŒã„ ã‹ãªã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã©ã£ã¡ ãŒ ãªãŒã„ ã‹ãªã€‚"
            },
            {
              type: "sentence",
              jp: "ãã‚‰ã¹ã¦ ã¿ã‚ˆã†ã€‚",
              kana: "ãã‚‰ã¹ã¦ ã¿ã‚ˆã†ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãã‚‰ã¹ã¦ ã¿ã‚ˆã†ã€‚"
            },
            {
              type: "sentence",
              jp: "ã‚ã£ã¡ãŒ ãªãŒãã¦ã€ ã“ã£ã¡ãŒ ã¿ã˜ã‹ã„ã€‚",
              kana: "ã‚ã£ã¡ãŒ ãªãŒãã¦ã€ ã“ã£ã¡ãŒ ã¿ã˜ã‹ã„ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã‚ã£ã¡ãŒ ãªãŒãã¦ã€ ã“ã£ã¡ãŒ ã¿ã˜ã‹ã„ã€‚"
            }
          ]
        },
        {
          lessonId: 13,
          title: "ç¬¬13èª²ï½œãšã„ã¶ã‚“æ•£ã‚‰ã‹ã£ã¦ã„ã‚‹ã­",
          cards: [
            {
              type: "sentence",
              jp: "ã¸ã‚„ãŒ ãšã„ã¶ã‚“ ã¡ã‚‰ã‹ã£ã¦ã„ã‚‹ã­ã€‚",
              kana: "ã¸ã‚„ãŒ ãšã„ã¶ã‚“ ã¡ã‚‰ã‹ã£ã¦ã„ã‚‹ã­ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ã¸ã‚„ãŒ ãšã„ã¶ã‚“ ã¡ã‚‰ã‹ã£ã¦ã„ã‚‹ã­ã€‚"
            },
            {
              type: "sentence",
              jp: "ãšã„ã¶ã‚“ ã¡ã‚‰ã‹ã£ã¦ã„ã‚‹ã­ã€‚",
              kana: "ãšã„ã¶ã‚“ ã¡ã‚‰ã‹ã£ã¦ã„ã‚‹ã­ã€‚",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãšã„ã¶ã‚“ ã¡ã‚‰ã‹ã£ã¦ã„ã‚‹ã­ã€‚"
            },
            {
              type: "sentence",
              jp: "ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«",
              kana: "ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«"
            },
            {
              type: "sentence",
              jp: "ãƒªãƒ“ãƒ³ã‚°ãƒ«ãƒ¼ãƒ ",
              kana: "ãƒªãƒ“ãƒ³ã‚°ãƒ«ãƒ¼ãƒ ",
              romaji: "",
              zh: "",
              note: "",
              audioText: "ãƒªãƒ“ãƒ³ã‚°ãƒ«ãƒ¼ãƒ "
            }
          ]
        }
      ];

    </script>

    <!-- ====== ä¸‹é¢é€™æ®µï¼šéš¨æ©ŸæŠ½å¡ / æ˜Ÿæ˜Ÿæ¬Šé‡ / å¾ªç’° / ç™¼éŸ³é‚è¼¯ï¼Œè«‹ä¿æŒåŸæ¨£ ====== -->
    <script>
      const STORAGE_KEY = "jpStudyState_v1";

      let state = {
        cardDifficulty: {}, // { uid: 0~3 }
        cycleSeen: {} // { uid: true }
      };

      function loadState() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (raw) {
            const parsed = JSON.parse(raw);
            state = {
              cardDifficulty: parsed.cardDifficulty || {},
              cycleSeen: parsed.cycleSeen || {}
            };
          }
        } catch (e) {
          console.warn("è®€å–ç‹€æ…‹å¤±æ•—ï¼Œä½¿ç”¨é è¨­", e);
        }
      }

      function saveState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      }

      // æŠŠæ‰€æœ‰å¡ç‰‡æ•´ç†æˆ flat é™£åˆ—ï¼Œé †ä¾¿è‡ªå‹•çµ¦ uid
      const allCards = [];
      lessons.forEach((lesson) => {
        lesson.cards.forEach((card, index) => {
          const uid = `${lesson.lessonId}-${index + 1}`;
          allCards.push({
            ...card,
            lessonId: lesson.lessonId,
            lessonTitle: lesson.title,
            uid
          });
        });
      });

      // DOM
      const lessonSelect = document.getElementById("lessonSelect");
      const nextBtn = document.getElementById("nextBtn");
      const resetCycleBtn = document.getElementById("resetCycleBtn");

      const cardLesson = document.getElementById("cardLesson");
      const cardType = document.getElementById("cardType");
      const cardJp = document.getElementById("cardJp");
      const cardKana = document.getElementById("cardKana");
      const cardRomaji = document.getElementById("cardRomaji");
      const cardZh = document.getElementById("cardZh");
      const cardNote = document.getElementById("cardNote");
      const cycleProgressText = document.getElementById("cycleProgressText");
      const cycleStatus = document.getElementById("cycleStatus");
      const audioBtn = document.getElementById("audioBtn");
      const starElems = Array.from(
        document.querySelectorAll(".card-stars .star")
      );

      let currentCard = null;

      function initLessonSelect() {
        lessons.forEach((lesson) => {
          const opt = document.createElement("option");
          opt.value = String(lesson.lessonId);
          opt.textContent = lesson.title;
          lessonSelect.appendChild(opt);
        });
      }

      function getCurrentPool() {
        const value = lessonSelect.value;
        if (value === "all") return allCards;
        const lessonId = Number(value);
        return allCards.filter((c) => c.lessonId === lessonId);
      }

      // æ¬Šé‡æŠ½å¡ï¼šåŸºç¤ 1 + æ˜Ÿæ˜ŸåŠ æ¬Š + æœ¬è¼ªæœªçœ‹éåŠ æ¬Š
      function pickRandomCard() {
        const pool = getCurrentPool();
        if (pool.length === 0) return null;

        const weights = [];
        let totalWeight = 0;

        pool.forEach((card) => {
          const difficulty = state.cardDifficulty[card.uid] || 0; // 0~3
          let weight = 1 + difficulty * 1.5;

          if (!state.cycleSeen[card.uid]) {
            weight += 2; // é€™è¼ªé‚„æ²’å‡ºç¾éï¼Œå„ªå…ˆ
          }

          weights.push({ card, weight });
          totalWeight += weight;
        });

        let r = Math.random() * totalWeight;
        for (const w of weights) {
          if (r < w.weight) return w.card;
          r -= w.weight;
        }
        return weights[weights.length - 1].card;
      }

      function updateCardUI(card) {
        if (!card) {
          cardLesson.textContent = "";
          cardType.textContent = "";
          cardJp.textContent = "æ²’æœ‰å¡ç‰‡";
          cardKana.textContent = "";
          cardRomaji.textContent = "";
          cardZh.textContent = "";
          cardNote.textContent = "";
          starElems.forEach((el) => el.classList.remove("active"));
          return;
        }

        cardLesson.textContent = card.lessonTitle;
        cardType.textContent = card.type === "word" ? "ã€å–®å­—ã€‘" : "ã€å¥å­ã€‘";
        cardJp.textContent = card.jp;
        cardKana.textContent = card.kana || "";
        cardRomaji.textContent = card.romaji || "";
        cardZh.textContent = card.zh || "";
        cardNote.textContent = card.note || "";

        const stars = state.cardDifficulty[card.uid] || 0;
        starElems.forEach((el) => {
          const s = Number(el.dataset.star);
          if (s <= stars) el.classList.add("active");
          else el.classList.remove("active");
        });

        // æ¨™è¨˜ç‚ºæœ¬è¼ªå·²å‡ºç¾
        state.cycleSeen[card.uid] = true;
        saveState();
        updateProgressUI();
      }

      function updateProgressUI() {
        const pool = getCurrentPool();
        const total = pool.length;
        const seenCount = pool.filter((c) => state.cycleSeen[c.uid]).length;
        cycleProgressText.textContent = `æœ¬å¾ªç’°é€²åº¦ï¼š${seenCount} / ${total}`;

        if (total > 0 && seenCount === total) {
          cycleStatus.textContent =
            "âœ… é€™å€‹ç¯„åœè£¡çš„å¡ç‰‡æœ¬è¼ªéƒ½çœ‹éå›‰ï¼Œå¯ä»¥é‡è¨­å¾ªç’°æˆ–æ”¹åˆ¥çš„èª²ã€‚";
        } else {
          cycleStatus.textContent = "";
        }
      }

      // äº‹ä»¶
      nextBtn.addEventListener("click", () => {
        const card = pickRandomCard();
        currentCard = card;
        updateCardUI(card);
      });

      resetCycleBtn.addEventListener("click", () => {
        state.cycleSeen = {};
        saveState();
        updateProgressUI();
      });

      lessonSelect.addEventListener("change", () => {
        updateProgressUI();
      });

      starElems.forEach((el) => {
        el.addEventListener("click", () => {
          if (!currentCard) return;
          const starValue = Number(el.dataset.star);
          const current = state.cardDifficulty[currentCard.uid] || 0;
          const newValue = current === starValue ? 0 : starValue; // å†é»åŒä¸€é¡†å°±æ­¸é›¶
          state.cardDifficulty[currentCard.uid] = newValue;
          saveState();
          updateCardUI(currentCard);
        });
      });

      audioBtn.addEventListener("click", () => {
        if (!currentCard) return;
        if (!("speechSynthesis" in window)) {
          alert("é€™å€‹ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³ç™¼éŸ³ ğŸ˜­");
          return;
        }
        const utterance = new SpeechSynthesisUtterance(
          currentCard.audioText || currentCard.jp
        );
        utterance.lang = "ja-JP";
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utterance);
      });

      // å•Ÿå‹•
      loadState();
      initLessonSelect();
      updateProgressUI();
    </script>
  </body>
</html>




